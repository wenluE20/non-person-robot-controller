一、锥桶颜色分割
将 exp2 功能包添加至上节课建立的 sdv_ws 工作空间下（完整路径为～
/sdv_ws/src/exp2）
# 编译
cd sdv_ws
catkin_make

该功能包下包含两个节点：exp2_1 和 exp2_2（其中 exp2_1.cpp 可以直接运
行，exp2_2 需要补充注释部分的代码），分别对应本实验的 3.1 节和 3.2 节。

exp2_1.cpp 代码中定义了枚举变量 CameraState，若希望打开笔记本摄像头，
将第 20 行的 state 变量修改为 COMPUTER，若使用 ZED 版本机器人，修改 state
变量为 ZED（ZED 摄像头如无法正常打开，需修改 main 函数中 state=ZED 分支
代码中“capture.open(4)”中的设备号“4”至 0~3，保存并重新编译工作空间，直
到能正常打开 ZED 相机），若使用 REALSENSE 版本机器人，则修改 state 变量
为 REALSENSE。（注：若使用 REALSENSE 版本机器人，需先启动相机，打开
新终端：roslaunch realsense2_camera rs_rgbd.launch）。

exp2_1.cpp 代码中定义了两个函数，函数 BGR2HSI()将彩色图像从 RGB 空
间转换到 HIS 空间，函数 ColorSplitManual()实现调节滑动条进行颜色阈值分割。

# 打开一个新终端，启动移动机器人：
roslaunch dashgo_driver driver_imu.launch

# 在工作空间下打开一个新终端，运行 exp2_1 节点（注：sdv 为功能包名称，可改为自己建立的功能包名称）
source ~/sdv_ws/devel/setup.bash
rosrun exp2 exp2_1

运行节点成功后会出现 H、S、I 的滑动条，可以用鼠标拖动滑动条调整各个
分量的阈值范围。若像素点在设定的 H、S、I 范围内的像素会被分割成白色，范
围之外的像素为黑色，根据滑动条阈值分割的结果，可以判断各种颜色的 HSI 对
应的阈值。

将锥桶放置在机器人摄像头前方，调整 H、S、I 滑动条至合理的范围，将锥
桶从背景中分割出来，即锥桶部分为白色，背景为黑色，如图 4 所示。
 
分割成功后，记录此时的 H、S、I 范围。

二、识别颜色控制机器人运动
参考颜色阈值分割表，使用滑动条分割出红、绿、
蓝、黄这四种颜色，并记录下对应的 H、S、I 的区间范围，补充 exp2_2.cpp
的注释部分代码（只需补充有中文注释部分的内容，其它代码无需更改），

完成以下任务：

机器人通过摄像头获取当前图像（手持不同颜色的 A4 纸放在机器人
相机视野中），根据识别到的颜色，对机器人发出控制指令，其中：
红色：前进
绿色：后退
蓝色：左转
黄色：右转

提示：exp2_2.cpp 中需要补充的代码共四个部分：
1、ColorSplitAuto()函数实现自动的颜色阈值分割，接收三个参数，前
两个参数和 exp2_1.cpp 中的 ColorSplitManual()函数一致，第三个
参数定义了一个长度为 6 的颜色阈值数组，即 H、S、I 三个分量的上
下限，函数返回一个整数（被分割区域的像素点的个数），函数的实
现可以参考 ColorSplitManual()函数。
2、第二部分定义需要传递到 ColorSplitAuto()函数中的参数，即红、
黄、蓝、绿四种颜色对应的 HSI 阈值。
3、第三部分定义机器人速度话题，可以参考第一次实验代码。
4、第四部分根据机器人识别到的颜色发布不同的速度，使机器人向不同
方向运动。分别对四种目标颜色进行分割，根据 ColorSplitAuto()函
数返回值的大小来判断识别到的是哪一种颜色，再发布不同方向的速
度（/cmd_vel 话题中 x 方向的线速度控制机器人前后移动，z 方向的
角速度控制机器人左右旋转）。


